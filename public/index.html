<!DOCTYPE html>
<html lang="en">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Language" content="en" />

  <title>Money Game üéÆ | Smart Money Simulation Game</title>

  <meta name="description" content="Money Game is a fun and interactive simulation game where you manage money, make decisions, and grow your virtual wealth." />

  <meta name="robots" content="index, follow" />

  <!-- Optional keywords (not very important nowadays, but ok) -->
  <meta name="keywords" content="money game, simulation game, finance game, strategy game, browser game" />

  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/game-theme.css" />
  <link rel="icon" href="public/images/logo-money.webp" />
  <link rel="canonical" href="https://money-game.up.railway.app/">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/public/images/logo-money.webp">


  <!-- Open Graph (Facebook, Discord, WhatsApp) -->
  <meta property="og:title" content="Money Game üéÆ | Smart Money Simulation Game" />
  <meta property="og:description" content="Play Money Game and test your financial decisions in a fun money simulation game." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://money-game.up.railway.app/"/>
  <meta property="og:image" content="https://money-game.up.railway.app/public/images/logo-money.webp"/>

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Money Game üéÆ" />
  <meta name="twitter:description" content="A fun money simulation game ou can play in your browser." />
  <meta name="twitter:image" content="https://money-game.up.railway.app/public/images/logo-money.webp"/>

  <!-- Schema: Game / WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "VideoGame",
    "name": "Money Game",
    "description": "A browser-based money simulation game where players manage finances and make strategic decisions.",
    "url": "https://money-game.up.railway.app/",
    "applicationCategory": "Game",
    "operatingSystem": "Web",
    "author": {
      "@type": "Person",
      "name": "Karem Zatar"
    }
  }
  </script>
</head>

<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="nav-logo">üí∞ Money Game</a>
      <ul class="nav-menu">
        <li><a href="/" class="active">Game</a></li>
        <li><a href="javascript:openTutorial()">Help / Tutorial</a></li>
        <li><a href="javascript:reloadPage()" class="reload-btn">üîÑ Reload</a></li>
        <li><a href="javascript:logout()" class="logout-btn">Logout</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <!-- Static Ad Area -->
    <div class="ad-banner" style="margin-bottom: 20px;">
      <p>üåü SPONSORED CONTENT üåü</p>
      <p style="font-size: 12px;">Your permanent ad could be here! Reach thousands of players.</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Balance</div>
        <div class="stat-value" id="balanceText">$0.00</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Level</div>
        <div class="stat-value" id="levelText">1</div>
        <div
          style="width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 10px; overflow: hidden;">
          <div id="levelProgress"
            style="width: 0%; height: 100%; background: var(--primary-gradient); transition: width 0.3s;"></div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Click Multiplier</div>
        <div class="stat-value" id="multiplierText">x1</div>
        <div id="multiplierTimer" style="font-size: 14px; color: var(--accent-pink); display: none;">00:00</div>
      </div>
    </div>

    <div class="visa-card-container">
      <div class="visa-card" id="mainClicker">
        <div class="card-logo">üí∞</div>
        <div class="card-number">CLICK TO EARN</div>
        <div class="card-bottom">
          <div class="card-holder">
            <small>BUSINESS MANAGER</small>
            <h3 id="usernameText">Player</h3>
          </div>
        </div>
      </div>

      <div class="glass-card">
        <h3>Rewarded Video Ad</h3>
        <p>Watch a 30s video to get 5x income for 2 minutes!</p>
        <div id="adProgressArea" style="display:none; margin: 20px 0;">
          <div
            style="width: 100%; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow:hidden;">
            <div id="adProgressBar" style="width: 0%; height: 100%; background: var(--success-gradient);"></div>
          </div>
          <p id="adTimerText" style="margin-top: 10px;">Wait 30s...</p>
        </div>
        <button id="watchAdBtn" class="btn btn-secondary" style="margin-top: 15px;">‚ñ∂ Watch Ad (30s)</button>
      </div>
    </div>

    <div class="action-grid">
      <div class="glass-card" style="grid-column: span 2;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>Your Companies</h2>
          <button id="buyCompanyBtn" class="btn btn-small-primary">+ Buy New Company ($500)</button>
        </div>
        <div id="companiesList"
          style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
          <!-- Companies loaded here -->
        </div>
      </div>
    </div>
  </div>

  <script src="js/game-core.js"></script>
  <script src="js/onboarding.js"></script>
  <script src="js/game-v2.js"></script>
  <script src="js/tutorial.js"></script>
  <script src="js/offline-earnings.js"></script>
  <script src="js/daily-rewards.js"></script>
  <script src="js/idle-gameplay.js"></script>
  <script>
    function reloadPage() {
      const reloadBtn = document.querySelector('.reload-btn');
      reloadBtn.innerHTML = '‚è≥ Reloading...';
      reloadBtn.style.pointerEvents = 'none';
      
      setTimeout(() => {
        location.reload();
      }, 500);
    }
    
    async function logout() {
      await fetch('/api/auth/logout', { method: 'POST' });
      window.location.href = '/login.html';
    }

    function openTutorial() {
      try {
        if (window.onboardingSystem) {
          // Allow replay by resetting local state
          window.onboardingSystem.reset();
          window.onboardingSystem.show();
        } else {
          alert('Tutorial system is loading. Please try again in a moment.');
        }
      } catch (e) {
        console.error('Failed to open tutorial', e);
      }
    }

    // Offline earnings popup
    function showOfflineEarningsModal(info) {
      if (!info || !info.amount || info.amount <= 0) return;

      const overlay = document.createElement('div');
      overlay.id = 'offline-earnings-modal';
      overlay.style.position = 'fixed';
      overlay.style.inset = '0';
      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.background = 'rgba(10, 14, 39, 0.85)';
      overlay.style.backdropFilter = 'blur(10px)';
      overlay.style.zIndex = '9999';
      overlay.style.opacity = '0';
      overlay.style.transition = 'opacity 0.3s ease-out';

      const card = document.createElement('div');
      card.style.background = 'linear-gradient(135deg, #22c55e 0%, #16a34a 40%, #0f172a 100%)';
      card.style.borderRadius = '20px';
      card.style.padding = '32px 28px';
      card.style.maxWidth = '420px';
      card.style.width = '90%';
      card.style.color = '#ffffff';
      card.style.boxShadow = '0 18px 60px rgba(0,0,0,0.5)';
      card.style.position = 'relative';
      card.style.overflow = 'hidden';

      card.innerHTML = `
        <div style="position:absolute; inset:0; opacity:0.15; background-image:
          radial-gradient(circle at 0 0, rgba(255,255,255,0.3) 0, transparent 55%),
          radial-gradient(circle at 100% 100%, rgba(34,197,94,0.4) 0, transparent 60%);">
        </div>
        <div style="position:relative; z-index:1;">
          <div style="font-size:42px; margin-bottom:12px;">‚è±Ô∏èüí∞</div>
          <h2 style="margin:0 0 8px 0; font-size:24px; font-weight:800;">While you were away...</h2>
          <p style="margin:0 0 18px 0; font-size:15px; opacity:0.9;">
            Your businesses kept working for you! You earned:
          </p>
          <div id="offlineAmountDisplay" style="
            font-size:34px;
            font-weight:900;
            margin-bottom:12px;
            letter-spacing:0.03em;
          ">$0.00</div>
          <p style="margin:0 0 18px 0; font-size:13px; opacity:0.9;">
            Based on up to <strong>${info.hours || 'several'}</strong> hours of offline progression.
          </p>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:8px;">
            <button id="offlineCollectBtn" class="btn btn-primary" style="flex:1; min-width:120px;">
              Collect Earnings
            </button>
            <button id="offlineCloseBtn" class="btn btn-small-secondary" style="min-width:110px;">
              Maybe Later
            </button>
          </div>
          <p style="margin-top:14px; font-size:12px; opacity:0.85;">
            Future upgrades will increase your offline cap and passive income rate.
          </p>
        </div>
      `;

      overlay.appendChild(card);
      document.body.appendChild(overlay);

      // Fade in
      requestAnimationFrame(() => {
        overlay.style.opacity = '1';
      });

      // Animate number if core animations are available
      const amountElement = document.getElementById('offlineAmountDisplay');
      const amount = Number(info.amount) || 0;
      const formatted = amount.toLocaleString(undefined, {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      });

      if (window.Animations && typeof Animations.countUp === 'function') {
        Animations.countUp(
          amountElement,
          0,
          amount,
          900
        );
      } else {
        amountElement.textContent = `$${formatted}`;
      }

      function closeModal() {
        overlay.style.opacity = '0';
        setTimeout(() => {
          if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
        }, 250);
      }

      document.getElementById('offlineCollectBtn').addEventListener('click', () => {
        if (window.notifications) {
          window.notifications.money(
            `Collected $${formatted} in offline earnings!`,
            4000
          );
        }
        if (window.soundManager) {
          window.soundManager.play('money');
        }
        closeModal();
      });

      document.getElementById('offlineCloseBtn').addEventListener('click', closeModal);
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) closeModal();
      });
    }

    // Claim offline earnings once on load
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/api/offline-earnings/claim', { method: 'POST' })
        .then(res => res.ok ? res.json() : null)
        .then(data => {
          if (data && data.amount && data.amount > 0) {
            showOfflineEarningsModal(data);
          }
        })
        .catch(err => {
          console.warn('Offline earnings claim failed', err);
        });
    });
  </script>
</body>

</html>